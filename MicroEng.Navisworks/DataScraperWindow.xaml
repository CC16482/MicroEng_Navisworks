<Window x:Class="MicroEng.Navisworks.DataScraperWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:system="clr-namespace:System;assembly=System"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:MicroEng.Navisworks"
        Title="Data Scraper"
        Height="640" Width="900"
        Background="{DynamicResource ApplicationBackgroundBrush}"
        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
        FontSize="12"
        WindowStartupLocation="CenterOwner">
  <Window.Resources>
    <ResourceDictionary>
      <!-- Reduce WPF-UI typography for data-dense screens (Gallery is larger by default). -->
      <system:Double x:Key="ControlContentThemeFontSize">12</system:Double>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="{x:Static local:MicroEngResourceUris.WpfUiRoot}" />
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </Window.Resources>

  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <!-- NOTE: use ui:Card (not ui:CardControl) for general container layout; CardControl is a 3-column header/content control and will offset Content to the right. -->
    <ui:Card Grid.Row="0"
             Padding="10"
             Margin="0,0,0,8"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Top"
             HorizontalContentAlignment="Stretch"
             VerticalContentAlignment="Top">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Left">
          <ui:TextBlock Text="Data Scraper" FontSize="16" FontWeight="SemiBold" />
          <ui:TextBlock Text="Scan a scope and cache properties for Data Matrix / Mapper."
                        Margin="0,2,0,0"
                        FontSize="12"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
        </StackPanel>

        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
          <TextBlock Text="Profile:" VerticalAlignment="Center" Margin="0,0,6,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
          <TextBox x:Name="ProfileNameBox"
                   Width="170"
                   Padding="8,4"
                   VerticalContentAlignment="Center"
                   TextChanged="ProfileNameBox_TextChanged" />
          <ui:Button Content="Close"
                     Appearance="Primary"
                     Padding="12,6"
                     Margin="12,0,0,0"
                     Click="Close_Click" />
        </StackPanel>

        <ui:Card Grid.Row="1"
                 Grid.ColumnSpan="2"
                 Padding="8"
                 Margin="0,10,0,0"
                 HorizontalAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 VerticalContentAlignment="Top">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <ui:TextBlock Text="Scope" FontSize="13" FontWeight="SemiBold" Grid.ColumnSpan="2" />

            <StackPanel Grid.Row="1" Orientation="Vertical">
              <RadioButton x:Name="SingleItemRadio" Content="Single Item (pick current selection)" IsChecked="True" />
              <RadioButton x:Name="CurrentSelectionRadio" Content="Current Selection" />
              <RadioButton x:Name="SelectionSetRadio" Content="Selection Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="SearchSetRadio" Content="Search Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="EntireModelRadio" Content="Entire Model" />
            </StackPanel>

            <StackPanel Grid.Column="1" Grid.Row="1">
              <ComboBox x:Name="SelectionSetCombo" IsEnabled="False" Margin="0,0,0,6" />
              <ComboBox x:Name="SearchSetCombo" IsEnabled="False" Margin="0,0,0,6" />
              <ui:Button Content="Refresh Sets" Padding="10,4" Click="RefreshSets_Click" />
            </StackPanel>
          </Grid>
        </ui:Card>
      </Grid>
    </ui:Card>

    <!-- Tabs -->
    <ui:Card Grid.Row="1"
             Padding="10"
             Margin="0,0,0,8"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             HorizontalContentAlignment="Stretch"
             VerticalContentAlignment="Stretch">
      <TabControl Background="Transparent"
                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                  FontSize="12"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  HorizontalContentAlignment="Stretch"
                  VerticalContentAlignment="Stretch">
        <!-- Profile -->
        <TabItem Header="Profile">
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ui:DataGrid x:Name="ProfileList"
                         Grid.Row="0"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         AutoGenerateColumns="False"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         HeadersVisibility="Column"
                         GridLinesVisibility="All"
                         HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                         VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                         FontSize="12"
                         RowHeight="28"
                         ColumnHeaderHeight="30"
                         EnableRowVirtualization="True"
                         EnableColumnVirtualization="True"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling">
              <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Profile" Binding="{Binding ProfileName}" Width="140" />
                <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="150" />
                <DataGridTextColumn Header="Scope" Binding="{Binding ScopeType}" Width="140" />
                <DataGridTextColumn Header="Description" Binding="{Binding ScopeDescription}" Width="220" />
                <DataGridTextColumn Header="Items" Binding="{Binding ItemsScanned}" Width="80" />
                <DataGridTextColumn Header="Props" Binding="{Binding Properties.Count}" Width="80" />
              </ui:DataGrid.Columns>
            </ui:DataGrid>
            <TextBlock x:Name="ProfileSummaryText"
                       Grid.Row="1"
                       Margin="0,6,0,0"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
          </Grid>
        </TabItem>

        <!-- History -->
        <TabItem Header="History">
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ui:DataGrid x:Name="HistoryList"
                         Grid.Row="0"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         AutoGenerateColumns="False"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         HeadersVisibility="Column"
                         GridLinesVisibility="All"
                         HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                         VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                         SelectionChanged="HistoryList_SelectionChanged"
                         FontSize="12"
                         RowHeight="28"
                         ColumnHeaderHeight="30"
                         EnableRowVirtualization="True"
                         EnableColumnVirtualization="True"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling">
              <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Profile" Binding="{Binding ProfileName}" Width="140" />
                <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="150" />
                <DataGridTextColumn Header="Scope" Binding="{Binding ScopeType}" Width="140" />
                <DataGridTextColumn Header="Description" Binding="{Binding ScopeDescription}" Width="220" />
                <DataGridTextColumn Header="Items" Binding="{Binding ItemsScanned}" Width="80" />
                <DataGridTextColumn Header="Props" Binding="{Binding Properties.Count}" Width="80" />
              </ui:DataGrid.Columns>
            </ui:DataGrid>
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,6,0,0">
              <ui:Button Content="Re-run" Padding="10,4" Click="Rerun_Click" />
              <ui:Button Content="View Properties" Padding="10,4" Click="ViewProperties_Click" Margin="6,0,0,0" />
            </StackPanel>
          </Grid>
        </TabItem>

        <!-- Properties -->
        <TabItem Header="Properties">
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBox x:Name="FilterBox" Grid.Row="0" Margin="0,0,0,8" Padding="8,4" TextChanged="FilterBox_TextChanged" />
            <ui:DataGrid x:Name="PropertiesGrid"
                       Grid.Row="1"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       IsReadOnly="True"
                       AutoGenerateColumns="False"
                       GridLinesVisibility="All"
                       HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                       VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                       FontSize="12"
                       RowHeight="28"
                       ColumnHeaderHeight="30"
                       EnableRowVirtualization="True"
                       EnableColumnVirtualization="True"
                       VirtualizingPanel.IsVirtualizing="True"
                       VirtualizingPanel.VirtualizationMode="Recycling">
              <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150" />
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />
                <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="100" />
                <DataGridTextColumn Header="Items" Binding="{Binding ItemCount}" Width="80" />
                <DataGridTextColumn Header="Distinct" Binding="{Binding DistinctValueCount}" Width="80" />
                <DataGridTextColumn Header="Samples" Binding="{Binding SampleValuesString}" Width="*" />
              </ui:DataGrid.Columns>
            </ui:DataGrid>
            <TextBlock x:Name="PropertySummary" Grid.Row="2" Margin="0,6,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
          </Grid>
        </TabItem>

        <!-- Raw Data -->
        <TabItem Header="Raw Data">
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBox x:Name="RawFilterBox" Grid.Row="0" Margin="0,0,0,8" Padding="8,4" TextChanged="RawFilterBox_TextChanged" />
            <ui:DataGrid x:Name="RawDataGrid"
                       Grid.Row="1"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       IsReadOnly="True"
                       AutoGenerateColumns="False"
                       GridLinesVisibility="All"
                       HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                       VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                       FontSize="12"
                       RowHeight="28"
                       ColumnHeaderHeight="30"
                       EnableRowVirtualization="True"
                       EnableColumnVirtualization="True"
                       VirtualizingPanel.IsVirtualizing="True"
                       VirtualizingPanel.VirtualizationMode="Recycling">
              <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Profile" Binding="{Binding Profile}" Width="110" />
                <DataGridTextColumn Header="Scope" Binding="{Binding Scope}" Width="150" />
                <DataGridTextColumn Header="Item" Binding="{Binding ItemPath}" Width="200" />
                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150" />
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="180" />
                <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="110" />
                <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*" />
              </ui:DataGrid.Columns>
            </ui:DataGrid>
            <TextBlock x:Name="RawSummaryText" Grid.Row="2" Margin="0,6,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
          </Grid>
        </TabItem>
      </TabControl>
    </ui:Card>

    <!-- Footer -->
    <ui:Card Grid.Row="2"
             Padding="10"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Bottom"
             HorizontalContentAlignment="Stretch"
             VerticalContentAlignment="Center">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <TextBlock x:Name="StatusText" Text="Ready" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
        <ui:Button Grid.Column="1" Content="Run Scrape" Appearance="Primary" Margin="8,0,0,0" Padding="12,6" Click="Run_Click" />
      </Grid>
    </ui:Card>
  </Grid>
</Window>
