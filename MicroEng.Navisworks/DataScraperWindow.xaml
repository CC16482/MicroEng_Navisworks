<Window x:Class="MicroEng.Navisworks.DataScraperWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Data Scraper"
        Height="640" Width="900"
        Background="#f5f7fb"
        WindowStartupLocation="CenterOwner">
  <Window.Resources>
    <SolidColorBrush x:Key="BgPanel" Color="#f5f7fb" />
    <SolidColorBrush x:Key="BgMuted" Color="#eef1f4" />
    <SolidColorBrush x:Key="TextPrimary" Color="#111827" />
    <SolidColorBrush x:Key="TextSecondary" Color="#374151" />
    <SolidColorBrush x:Key="Accent" Color="#8ba9d9" />
    <Style x:Key="PrimaryButton" TargetType="Button">
      <Setter Property="Background" Value="{StaticResource Accent}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="Padding" Value="10,6" />
      <Setter Property="Margin" Value="4" />
      <Setter Property="BorderThickness" Value="0" />
    </Style>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <GroupBox Header="Profile" Grid.Row="0" Padding="8" Margin="0,0,0,8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
          <TextBlock Text="Profile Name:" VerticalAlignment="Center" Margin="0,0,6,0" />
          <TextBox x:Name="ProfileNameBox" Width="240" TextChanged="ProfileNameBox_TextChanged" />
        </StackPanel>
        <GroupBox Header="Scope" Grid.Row="1" Padding="8">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel>
              <RadioButton x:Name="SingleItemRadio" Content="Single Item (pick current selection)" IsChecked="True" />
              <RadioButton x:Name="CurrentSelectionRadio" Content="Current Selection" />
              <RadioButton x:Name="SelectionSetRadio" Content="Selection Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="SearchSetRadio" Content="Search Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="EntireModelRadio" Content="Entire Model" />
            </StackPanel>
            <StackPanel Grid.Column="1">
              <ComboBox x:Name="SelectionSetCombo" Margin="0,0,0,6" IsEnabled="False" />
              <ComboBox x:Name="SearchSetCombo" Margin="0,0,0,6" IsEnabled="False" />
              <Button Content="Refresh Sets" Click="RefreshSets_Click" />
            </StackPanel>
          </Grid>
        </GroupBox>
      </Grid>
    </GroupBox>

    <TabControl Grid.Row="1" Margin="0,0,0,8">
      <TabItem Header="Profile">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <ListView x:Name="ProfileList" Grid.Row="0">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Profile" DisplayMemberBinding="{Binding ProfileName}" Width="140" />
                <GridViewColumn Header="Time" DisplayMemberBinding="{Binding Timestamp}" Width="120" />
                <GridViewColumn Header="Scope" DisplayMemberBinding="{Binding ScopeType}" Width="120" />
                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding ScopeDescription}" Width="220" />
                <GridViewColumn Header="Items" DisplayMemberBinding="{Binding ItemsScanned}" Width="80" />
                <GridViewColumn Header="Props" Width="80">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Properties.Count}" />
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
          <TextBlock x:Name="ProfileSummaryText" Grid.Row="1" Margin="0,6,0,0" Foreground="{StaticResource TextSecondary}" />
        </Grid>
      </TabItem>
      <TabItem Header="History">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <ListView x:Name="HistoryList" Grid.Row="0" SelectionChanged="HistoryList_SelectionChanged">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Profile" DisplayMemberBinding="{Binding ProfileName}" Width="140" />
                <GridViewColumn Header="Time" DisplayMemberBinding="{Binding Timestamp}" Width="120" />
                <GridViewColumn Header="Scope" DisplayMemberBinding="{Binding ScopeType}" Width="120" />
                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding ScopeDescription}" Width="220" />
                <GridViewColumn Header="Items" DisplayMemberBinding="{Binding ItemsScanned}" Width="80" />
                <GridViewColumn Header="Props" Width="80">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Properties.Count}" />
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
          <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,6,0,0">
            <Button Content="Re-run" Click="Rerun_Click" />
            <Button Content="View Properties" Click="ViewProperties_Click" Margin="6,0,0,0" />
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Properties">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <TextBox x:Name="FilterBox" Grid.Row="0" Margin="0,0,0,6" TextChanged="FilterBox_TextChanged" />
          <DataGrid x:Name="PropertiesGrid" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150" />
              <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />
              <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="100" />
              <DataGridTextColumn Header="Items" Binding="{Binding ItemCount}" Width="80" />
              <DataGridTextColumn Header="Distinct" Binding="{Binding DistinctValueCount}" Width="80" />
              <DataGridTextColumn Header="Samples" Binding="{Binding SampleValuesString}" Width="*" />
            </DataGrid.Columns>
          </DataGrid>
          <TextBlock x:Name="PropertySummary" Grid.Row="2" Margin="0,6,0,0" Foreground="{StaticResource TextSecondary}" />
        </Grid>
      </TabItem>
    </TabControl>

    <Grid Grid.Row="2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>
      <TextBlock x:Name="StatusText" Text="Ready" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}" />
      <Button Grid.Column="1" Content="Run Scrape" Style="{StaticResource PrimaryButton}" Click="Run_Click" />
      <Button Grid.Column="2" Content="Close" Margin="6,4,0,4" Click="Close_Click" />
    </Grid>
  </Grid>
</Window>
