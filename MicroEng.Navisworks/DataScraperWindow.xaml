<Window x:Class="MicroEng.Navisworks.DataScraperWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="Data Scraper"
        Height="640" Width="900"
        Background="{DynamicResource AppBackgroundBrush}"
        WindowStartupLocation="CenterOwner">
  <Window.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/MicroEng.Navisworks;component/Assets/Theme/MicroEngUiKit.xaml" />
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </Window.Resources>

  <Grid Margin="{StaticResource PagePadding}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <ui:Card Grid.Row="0" Padding="10" Margin="0,0,0,8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="3*" />
          <ColumnDefinition Width="2*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Vertical">
          <TextBlock Text="Data Scraper" Style="{StaticResource PageTitleText}" />
          <TextBlock Text="Scan a scope and cache properties for Data Matrix / Mapper." Style="{StaticResource SubtleText}" />
        </StackPanel>

        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,8,0">
          <TextBlock Text="Profile Name:" VerticalAlignment="Center" Margin="0,0,6,0" />
          <TextBox x:Name="ProfileNameBox" Width="200" Style="{StaticResource InputTextBoxStyle}" TextChanged="ProfileNameBox_TextChanged" />
        </StackPanel>

        <StackPanel Grid.Row="0" Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
          <Button Content="Run Scrape" Style="{StaticResource PrimaryButtonStyle}" Click="Run_Click" />
          <Button Content="Close" Style="{StaticResource SecondaryButtonStyle}" Click="Close_Click" />
        </StackPanel>

        <Border Grid.Row="1" Grid.ColumnSpan="3" Style="{StaticResource CardBorder}">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Text="Scope" Style="{StaticResource SectionTitleText}" Grid.ColumnSpan="2" />

            <StackPanel Grid.Row="1">
              <RadioButton x:Name="SingleItemRadio" Content="Single Item (pick current selection)" IsChecked="True" />
              <RadioButton x:Name="CurrentSelectionRadio" Content="Current Selection" />
              <RadioButton x:Name="SelectionSetRadio" Content="Selection Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="SearchSetRadio" Content="Search Set (coming soon)" IsEnabled="False" />
              <RadioButton x:Name="EntireModelRadio" Content="Entire Model" />
            </StackPanel>
            <StackPanel Grid.Column="1" Grid.Row="1">
              <ComboBox x:Name="SelectionSetCombo" Style="{StaticResource InputComboBoxStyle}" IsEnabled="False" />
              <ComboBox x:Name="SearchSetCombo" Style="{StaticResource InputComboBoxStyle}" IsEnabled="False" />
              <Button Content="Refresh Sets" Style="{StaticResource SecondaryButtonStyle}" Click="RefreshSets_Click" />
            </StackPanel>
          </Grid>
        </Border>
      </Grid>
    </ui:Card>

    <TabControl Grid.Row="1" Margin="0,0,0,8">
      <TabItem Header="Profile">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <ListView x:Name="ProfileList" Grid.Row="0">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Profile" DisplayMemberBinding="{Binding ProfileName}" Width="140" />
                <GridViewColumn Header="Time" DisplayMemberBinding="{Binding Timestamp}" Width="120" />
                <GridViewColumn Header="Scope" DisplayMemberBinding="{Binding ScopeType}" Width="120" />
                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding ScopeDescription}" Width="220" />
                <GridViewColumn Header="Items" DisplayMemberBinding="{Binding ItemsScanned}" Width="80" />
                <GridViewColumn Header="Props" Width="80">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Properties.Count}" />
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
          <TextBlock x:Name="ProfileSummaryText" Grid.Row="1" Margin="0,6,0,0" Foreground="{StaticResource TextSecondary}" />
        </Grid>
      </TabItem>
      <TabItem Header="History">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <ListView x:Name="HistoryList" Grid.Row="0" SelectionChanged="HistoryList_SelectionChanged">
            <ListView.View>
              <GridView>
                <GridViewColumn Header="Profile" DisplayMemberBinding="{Binding ProfileName}" Width="140" />
                <GridViewColumn Header="Time" DisplayMemberBinding="{Binding Timestamp}" Width="120" />
                <GridViewColumn Header="Scope" DisplayMemberBinding="{Binding ScopeType}" Width="120" />
                <GridViewColumn Header="Description" DisplayMemberBinding="{Binding ScopeDescription}" Width="220" />
                <GridViewColumn Header="Items" DisplayMemberBinding="{Binding ItemsScanned}" Width="80" />
                <GridViewColumn Header="Props" Width="80">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Properties.Count}" />
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
          <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,6,0,0">
            <Button Content="Re-run" Click="Rerun_Click" />
            <Button Content="View Properties" Click="ViewProperties_Click" Margin="6,0,0,0" />
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Properties">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <TextBox x:Name="FilterBox" Grid.Row="0" Margin="0,0,0,6" TextChanged="FilterBox_TextChanged" />
          <DataGrid x:Name="PropertiesGrid" Grid.Row="1" Style="{StaticResource DataGridStandardStyle}" IsReadOnly="True">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150" />
              <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />
              <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="100" />
              <DataGridTextColumn Header="Items" Binding="{Binding ItemCount}" Width="80" />
              <DataGridTextColumn Header="Distinct" Binding="{Binding DistinctValueCount}" Width="80" />
              <DataGridTextColumn Header="Samples" Binding="{Binding SampleValuesString}" Width="*" />
            </DataGrid.Columns>
          </DataGrid>
          <TextBlock x:Name="PropertySummary" Grid.Row="2" Margin="0,6,0,0" Foreground="{StaticResource TextSecondary}" />
        </Grid>
      </TabItem>
      <TabItem Header="Raw Data">
        <Grid Margin="6">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <TextBox x:Name="RawFilterBox" Grid.Row="0" Margin="0,0,0,6" TextChanged="RawFilterBox_TextChanged" />
          <DataGrid x:Name="RawDataGrid" Grid.Row="1" Style="{StaticResource DataGridStandardStyle}" IsReadOnly="True">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Profile" Binding="{Binding Profile}" Width="100" />
              <DataGridTextColumn Header="Scope" Binding="{Binding Scope}" Width="140" />
              <DataGridTextColumn Header="Item" Binding="{Binding ItemPath}" Width="180" />
              <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150" />
              <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="180" />
              <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="100" />
              <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*" />
            </DataGrid.Columns>
          </DataGrid>
          <TextBlock x:Name="RawSummaryText" Grid.Row="2" Margin="0,6,0,0" Foreground="{StaticResource TextSecondary}" />
        </Grid>
      </TabItem>
    </TabControl>

    <Grid Grid.Row="2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>
      <TextBlock x:Name="StatusText" Text="Ready" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}" />
      <Button Grid.Column="1" Content="Run Scrape" Style="{StaticResource PrimaryButton}" Click="Run_Click" />
      <Button Grid.Column="2" Content="Close" Margin="6,4,0,4" Click="Close_Click" />
    </Grid>
  </Grid>
</Window>
