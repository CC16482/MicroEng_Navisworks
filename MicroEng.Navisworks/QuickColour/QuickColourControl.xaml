<UserControl x:Class="MicroEng.Navisworks.QuickColour.QuickColourControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:local="clr-namespace:MicroEng.Navisworks"
             xmlns:system="clr-namespace:System;assembly=System"
             mc:Ignorable="d"
             d:DesignHeight="900"
             d:DesignWidth="980"
             Background="{DynamicResource ApplicationBackgroundBrush}"
             Foreground="{DynamicResource TextFillColorPrimaryBrush}"
             FontSize="12">
    <UserControl.Resources>
        <ResourceDictionary>
            <system:Double x:Key="ControlContentThemeFontSize">12</system:Double>
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="{x:Static local:MicroEngResourceUris.WpfUiRoot}" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ui:Card Grid.Row="0"
                 Padding="12"
                 Margin="0,0,0,8"
                 HorizontalAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 VerticalContentAlignment="Top">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Vertical">
                    <ui:TextBlock Text="Quick Colour" FontSize="16" FontWeight="SemiBold" />
                    <ui:TextBlock Text="Rapidly colorize model items from Data Scraper profiles."
                                  Margin="0,2,0,0"
                                  FontSize="12"
                                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                </StackPanel>
                <ui:Button Grid.Column="1"
                           Content="Open Data Scraper"
                           Padding="12,6"
                           Click="OpenDataScraper_Click" />
            </Grid>
        </ui:Card>

        <ui:Card Grid.Row="1"
                 Padding="10"
                 HorizontalAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 VerticalContentAlignment="Stretch">
            <TabControl Background="Transparent"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        FontSize="12"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch">
                <TabItem Header="Appearance Profile">
                    <StackPanel Margin="10">
                        <ui:TextBlock Text="Appearance Profile" FontSize="14" FontWeight="SemiBold" />
                        <ui:TextBlock Text="Define reusable appearance profiles (coming soon)."
                                      Margin="0,4,0,0"
                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </TabItem>

                <TabItem Header="Quick Colour">
                    <StackPanel Margin="10">
                        <ui:TextBlock Text="Quick Colour" FontSize="14" FontWeight="SemiBold" />
                        <ui:TextBlock Text="Single-property coloring presets (coming soon)."
                                      Margin="0,4,0,0"
                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </TabItem>

                <TabItem Header="Hierarchy Builder">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Profile:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <ComboBox ItemsSource="{Binding ScraperProfiles}"
                                          SelectedItem="{Binding SelectedScraperProfile}"
                                          DisplayMemberPath="Label"
                                          Width="220"
                                          Margin="0,0,8,0" />
                                <ui:Button Content="Refresh" Padding="10,4" Margin="0,0,8,0" Click="RefreshProfiles_Click" />
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <TextBlock Text="Scope:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <ComboBox ItemsSource="{Binding ScopeOptions}"
                                          SelectedItem="{Binding SelectedScope}"
                                          Width="160" />
                            </StackPanel>
                        </Grid>

                        <Grid Grid.Row="1" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Level 1 property" FontWeight="SemiBold" />
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBox Text="{Binding HierarchyL1Label}" IsReadOnly="True" MinWidth="260" />
                                    <ui:Button Content="Pick..." Margin="8,0,0,0" Click="PickHierarchyL1_Click" />
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Level 2 property" FontWeight="SemiBold" />
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBox Text="{Binding HierarchyL2Label}" IsReadOnly="True" MinWidth="260" />
                                    <ui:Button Content="Pick..." Margin="8,0,0,0" Click="PickHierarchyL2_Click" />
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="2" VerticalAlignment="Bottom">
                                <ui:Button Content="Load Hierarchy"
                                           Appearance="Primary"
                                           Padding="12,6"
                                           Click="LoadHierarchy_Click" />
                            </StackPanel>
                        </Grid>

                        <WrapPanel Grid.Row="2" Margin="0,10,0,0">
                            <TextBlock Text="Palette:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <ComboBox ItemsSource="{Binding PaletteStyleOptions}"
                                      SelectedItem="{Binding HierarchyPaletteStyle}"
                                      Width="110"
                                      Margin="0,0,12,0" />
                            <TextBlock Text="Type shade spread:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <Slider Width="140"
                                    Minimum="10" Maximum="90"
                                    TickFrequency="10"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="Both"
                                    Value="{Binding HierarchyShadeSpreadPct, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,12,0" />
                            <TextBlock Text="Sort types:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <ComboBox ItemsSource="{Binding TypeSortOptions}"
                                      SelectedItem="{Binding HierarchyTypeSortMode}"
                                      Width="110"
                                      Margin="0,0,12,0" />
                            <CheckBox Content="Include blanks"
                                      IsChecked="{Binding HierarchyIncludeBlanks}"
                                      VerticalAlignment="Center"
                                      Margin="0,0,12,0" />
                            <TextBlock Text="Max categories:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding HierarchyMaxCategories}" Width="60" Margin="0,0,12,0" />
                            <TextBlock Text="Max types:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding HierarchyMaxTypesPerCategory}" Width="60" Margin="0,0,12,0" />
                        </WrapPanel>

                        <WrapPanel Grid.Row="3" Margin="0,8,0,0">
                            <CheckBox Content="Lock hue (single hue mode)"
                                      IsChecked="{Binding HierarchySingleHueMode, Mode=TwoWay}"
                                      Margin="0,0,12,0" />
                            <Border Width="18" Height="18" CornerRadius="2"
                                    BorderBrush="Gray" BorderThickness="1"
                                    Background="{Binding HierarchyHueSwatchBrush}"
                                    Margin="0,0,6,0" />
                            <TextBox Width="90"
                                     Text="{Binding HierarchyHueHex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding HierarchySingleHueMode}"
                                     Margin="0,0,6,0" />
                            <ui:Button Content="Pick..."
                                       Click="PickHierarchyHue_Click"
                                       IsEnabled="{Binding HierarchySingleHueMode}"
                                       Margin="0,0,14,0" />
                            <TextBlock Text="Category contrast:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <Slider Width="140"
                                    Minimum="20" Maximum="90"
                                    TickFrequency="10"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="Both"
                                    Value="{Binding HierarchyCategoryContrastPct, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    IsEnabled="{Binding HierarchySingleHueMode}"
                                    Margin="0,0,14,0" />
                            <CheckBox Content="Use Hue Groups"
                                      IsChecked="{Binding HierarchyUseHueGroups, Mode=TwoWay}"
                                      Margin="0,0,12,0" />
                            <CheckBox Content="Create folders by Hue Group"
                                      IsChecked="{Binding CreateFoldersByHueGroup, Mode=TwoWay}"
                                      IsEnabled="{Binding HierarchyUseHueGroups}"
                                      Margin="0,0,12,0" />
                        </WrapPanel>

                        <Expander Grid.Row="4"
                                  Header="Hue Groups"
                                  IsExpanded="False"
                                  Margin="0,8,0,8"
                                  Visibility="{Binding HierarchyUseHueGroups, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <ui:DataGrid ItemsSource="{Binding HueGroups}"
                                             SelectedItem="{Binding SelectedHueGroup}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             RowHeight="26"
                                             FontSize="12"
                                             GridLinesVisibility="All"
                                             HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                             VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}">
                                    <ui:DataGrid.Columns>
                                        <DataGridCheckBoxColumn Header="On" Binding="{Binding Enabled}" Width="42" />
                                        <DataGridTemplateColumn Header="Hue" Width="70">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding SwatchBrush}"
                                                            BorderBrush="Gray" BorderThickness="1"
                                                            Height="16" Width="52" CornerRadius="2" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Group" Binding="{Binding Name}" Width="160" />
                                        <DataGridTextColumn Header="Hex" Binding="{Binding HueHex, UpdateSourceTrigger=PropertyChanged}" Width="110" />
                                    </ui:DataGrid.Columns>
                                </ui:DataGrid>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <ui:Button Content="Add Group" Width="110" Margin="0,0,8,0" Click="AddHueGroup_Click" />
                                    <ui:Button Content="Remove Selected" Width="140" Margin="0,0,8,0" Click="RemoveHueGroup_Click" />
                                    <ui:Button Content="Reset Defaults" Width="130" Click="ResetHueGroups_Click" />
                                </StackPanel>

                                <TextBlock Text="Auto Assignment" FontWeight="SemiBold" Margin="0,12,0,4" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding DisciplineMapPath}" IsReadOnly="True" Margin="0,0,8,0" />
                                    <ui:Button Grid.Column="1" Content="Open" Width="80" Margin="0,0,6,0" Click="OpenDisciplineMap_Click" />
                                    <ui:Button Grid.Column="2" Content="Reload" Width="80" Margin="0,0,6,0" Click="ReloadDisciplineMap_Click" />
                                    <ui:Button Grid.Column="3" Content="Auto Assign" Width="110" Click="AutoAssignHueGroups_Click" />
                                </Grid>
                                <WrapPanel Margin="0,6,0,0">
                                    <CheckBox Content="Only assign categories currently set to Other"
                                              IsChecked="{Binding AutoAssignOnlyFallback}"
                                              Margin="0,0,12,0" />
                                    <CheckBox Content="Skip locked categories"
                                              IsChecked="{Binding AutoAssignSkipLocked}"
                                              Margin="0,0,12,0" />
                                    <CheckBox Content="Auto-create missing Hue Groups"
                                              IsChecked="{Binding AutoAssignCreateMissingGroups}" />
                                </WrapPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <ui:Button Content="Preview" Width="90" Margin="0,0,8,0" Click="PreviewHueMap_Click" />
                                    <ui:Button Content="Apply" Width="90" Margin="0,0,8,0" Click="AutoAssignHueGroups_Click" />
                                    <CheckBox Content="Show changes only"
                                              IsChecked="{Binding PreviewShowChangesOnly, Mode=TwoWay}"
                                              VerticalAlignment="Center" />
                                </StackPanel>

                                <TextBlock Text="{Binding AutoAssignPreviewSummary}"
                                           Margin="0,6,0,6"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />

                                <ui:DataGrid ItemsSource="{Binding AutoAssignPreviewRows}"
                                             AutoGenerateColumns="False"
                                             CanUserAddRows="False"
                                             CanUserReorderColumns="True"
                                             IsReadOnly="True"
                                             GridLinesVisibility="All"
                                             RowHeight="26"
                                             FontSize="12"
                                             Margin="0,0,0,8"
                                             HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                             VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}">
                                    <ui:DataGrid.Columns>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="220" />
                                        <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="70" />
                                        <DataGridTextColumn Header="Types" Binding="{Binding TypeCount}" Width="60" />
                                        <DataGridCheckBoxColumn Header="Lock" Binding="{Binding Locked}" Width="55" />
                                        <DataGridTextColumn Header="Current" Binding="{Binding CurrentGroup}" Width="140" />
                                        <DataGridTextColumn Header="Proposed" Binding="{Binding ProposedGroup}" Width="140" />
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="170" />
                                        <DataGridTextColumn Header="Reason" Binding="{Binding Reason}" Width="260" />
                                        <DataGridTextColumn Header="Matched Group" Binding="{Binding MatchedRuleGroup}" Width="140" />
                                        <DataGridTextColumn Header="Match Type" Binding="{Binding MatchedMatcherType}" Width="90" />
                                        <DataGridTextColumn Header="Pattern" Binding="{Binding MatchedMatcherValue}" Width="220" />
                                    </ui:DataGrid.Columns>
                                </ui:DataGrid>
                            </StackPanel>
                        </Expander>

                        <ui:DataGrid Grid.Row="5"
                                     ItemsSource="{Binding HierarchyGroups}"
                                     AutoGenerateColumns="False"
                                     CanUserAddRows="False"
                                     RowHeight="26"
                                     FontSize="12"
                                     GridLinesVisibility="All"
                                     HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                     VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                     RowDetailsVisibilityMode="VisibleWhenSelected">
                            <ui:DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="On" Binding="{Binding Enabled}" Width="42" />
                                <DataGridTemplateColumn Header="Base" Width="64">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="{Binding BaseSwatchBrush}"
                                                    BorderBrush="Gray" BorderThickness="1"
                                                    Height="16" Width="48" CornerRadius="2" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Hex" Binding="{Binding BaseHex, UpdateSourceTrigger=PropertyChanged}" Width="90" />
                                <DataGridTextColumn Header="Category" Binding="{Binding Value}" Width="220" />
                                <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="80" />
                                <DataGridTextColumn Header="Types" Binding="{Binding TypeCount}" Width="70" />
                                <DataGridTemplateColumn Header="Hue Group" Width="160">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.HueGroupOptions, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      SelectedItem="{Binding HueGroupName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      IsEnabled="{Binding DataContext.HierarchyUseHueGroups, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      MinWidth="140" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridCheckBoxColumn Header="Lock" Binding="{Binding UseCustomBaseColor}" Width="52" />
                            </ui:DataGrid.Columns>
                            <ui:DataGrid.RowDetailsTemplate>
                                <DataTemplate>
                                    <ui:DataGrid ItemsSource="{Binding Types}"
                                                 AutoGenerateColumns="False"
                                                 CanUserAddRows="False"
                                                 RowHeight="24"
                                                 FontSize="12"
                                                 GridLinesVisibility="All"
                                                 HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                                 VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}">
                                        <ui:DataGrid.Columns>
                                            <DataGridCheckBoxColumn Header="On" Binding="{Binding Enabled}" Width="42" />
                                            <DataGridTemplateColumn Header="Shade" Width="64">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{Binding SwatchBrush}"
                                                                BorderBrush="Gray" BorderThickness="1"
                                                                Height="16" Width="48" CornerRadius="2" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Header="Hex" Binding="{Binding ColorHex, UpdateSourceTrigger=PropertyChanged}" Width="90" />
                                            <DataGridTextColumn Header="Type" Binding="{Binding Value}" Width="240" />
                                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="80" />
                                        </ui:DataGrid.Columns>
                                    </ui:DataGrid>
                                </DataTemplate>
                            </ui:DataGrid.RowDetailsTemplate>
                        </ui:DataGrid>

                        <StackPanel Grid.Row="6" Margin="0,10,0,0">
                            <WrapPanel>
                                <ui:Button Content="Auto Assign Base Colours" Margin="0,0,8,0" Click="AutoAssignBaseColours_Click" />
                                <ui:Button Content="Regenerate Type Shades" Margin="0,0,8,0" Click="RegenerateTypeShades_Click" />
                                <ui:Button Content="Apply Temporary" Appearance="Primary" Margin="12,0,8,0" Click="ApplyTemporary_Click" />
                                <ui:Button Content="Clear Temporary" Margin="0,0,8,0" Click="ClearTemporary_Click" />
                                <ui:Button Content="Generate Permanent Profile" Appearance="Primary" Margin="12,0,8,0" Click="ApplyPermanent_Click" />
                                <ui:Button Content="Reset Permanent" Margin="0,0,8,0" Click="ResetPermanent_Click" />
                            </WrapPanel>
                            <WrapPanel Margin="0,8,0,0">
                                <CheckBox Content="Create Search Sets"
                                          IsChecked="{Binding CreateSearchSets}"
                                          Margin="0,0,12,0" />
                                <CheckBox Content="Create Snapshots"
                                          IsChecked="{Binding CreateSnapshots}"
                                          Margin="0,0,12,0" />
                                <TextBlock Text="Folder:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <TextBox Text="{Binding OutputFolderPath}" Width="220" Margin="0,0,12,0" />
                                <TextBlock Text="Profile name:" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <TextBox Text="{Binding OutputProfileName}" Width="180" />
                            </WrapPanel>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>
        </ui:Card>

        <ui:Card Grid.Row="2"
                 Padding="10"
                 HorizontalAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 VerticalContentAlignment="Center">
            <TextBlock Text="{Binding StatusText}"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
        </ui:Card>
    </Grid>
</UserControl>
