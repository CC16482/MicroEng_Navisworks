<Window x:Class="MicroEng.Navisworks.TreeMapper.TreeMapperWindow"
        x:ClassModifier="internal"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:system="clr-namespace:System;assembly=System"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:MicroEng.Navisworks"
        xmlns:treemapper="clr-namespace:MicroEng.Navisworks.TreeMapper"
        Title="Tree Mapper"
        Width="1100"
        Height="720"
        MinWidth="900"
        MinHeight="600"
        Background="{DynamicResource ApplicationBackgroundBrush}"
        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
        FontSize="12"
        WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="{x:Static local:MicroEngResourceUris.WpfUiRoot}" />
            </ResourceDictionary.MergedDictionaries>
            <system:Double x:Key="ControlContentThemeFontSize">12</system:Double>
            <Style x:Key="SectionHeaderStyle" TargetType="ui:TextBlock">
                <Setter Property="FontTypography" Value="BodyStrong" />
                <Setter Property="Margin" Value="0,0,0,6" />
            </Style>
            <Style x:Key="LevelLabelStyle" TargetType="ui:TextBlock">
                <Setter Property="Appearance" Value="Secondary" />
                <Setter Property="FontSize" Value="11" />
                <Setter Property="Margin" Value="0,0,0,4" />
            </Style>
            <Style x:Key="TreeMapperColumnHeaderStyle" TargetType="DataGridColumnHeader">
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Setter Property="VerticalContentAlignment" Value="Center" />
                <Setter Property="Padding" Value="6,0,4,0" />
                <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                <Setter Property="BorderThickness" Value="0,0,0,1" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridColumnHeader">
                            <Grid SnapsToDevicePixels="True">
                                <Border x:Name="HeaderBorder"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter Margin="{TemplateBinding Padding}"
                                                      HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                      VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                      RecognizesAccessKey="True" />
                                </Border>
                                <Thumb x:Name="PART_LeftHeaderGripper"
                                       HorizontalAlignment="Left"
                                       Background="Transparent"
                                       Width="6"
                                       Cursor="SizeWE"
                                       Opacity="0" />
                                <Thumb x:Name="PART_RightHeaderGripper"
                                       HorizontalAlignment="Right"
                                       Background="Transparent"
                                       Width="6"
                                       Cursor="SizeWE"
                                       Opacity="0" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.6" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:Card Grid.Row="0"
                 Padding="10"
                 Margin="0,0,0,8"
                 HorizontalAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 VerticalContentAlignment="Top">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Vertical">
                    <ui:TextBlock Text="Tree Mapper" FontSize="16" FontWeight="SemiBold" />
                    <ui:TextBlock Text="{Binding CacheStatusText}"
                                  Margin="0,4,0,0"
                                  FontSize="12"
                                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,10,0,0">
                    <WrapPanel VerticalAlignment="Center">
                        <TextBlock Text="Data Source:" VerticalAlignment="Center" Margin="0,0,6,0" />
                        <ComboBox Width="260"
                                  Margin="0,0,8,0"
                                  ItemsSource="{Binding SessionOptions}"
                                  SelectedItem="{Binding SelectedSession}"
                                  DisplayMemberPath="Label" />
                        <ui:Button Width="36"
                                   Height="30"
                                   Padding="0"
                                   Margin="0,0,6,0"
                                   ToolTip="Refresh sessions"
                                   Click="RefreshSessions_Click">
                            <ui:SymbolIcon Symbol="ArrowSync20" FontSize="20" />
                        </ui:Button>
                        <ui:Button Width="36"
                                   Height="30"
                                   Padding="0"
                                   Margin="0,0,6,0"
                                   ToolTip="Open Data Scraper"
                                   Click="OpenDataScraper_Click">
                            <ui:SymbolIcon Symbol="DatabaseLightning20" FontSize="18" />
                        </ui:Button>
                        <ui:Button Width="36"
                                   Height="30"
                                   Padding="0"
                                   Margin="0,0,12,0"
                                   ToolTip="Open Data Matrix"
                                   Click="OpenDataMatrix_Click">
                            <ui:SymbolIcon Symbol="TableSettings20" FontSize="18" />
                        </ui:Button>
                        <ui:Button MinWidth="190"
                                   IsEnabled="{Binding IsScrapeEnabled}"
                                   Click="RunScrape_Click">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="DatabaseLightning20" Margin="0,0,6,0" />
                                <ui:TextBlock Text="{Binding ScrapeButtonText}" />
                            </StackPanel>
                        </ui:Button>
                        <ui:Button Content="Publish to Selection Tree"
                                   Appearance="Primary"
                                   Background="White"
                                   Foreground="Black"
                                   Padding="12,6"
                                   Margin="12,0,0,0"
                                   IsEnabled="{Binding IsPublishEnabled}"
                                   Click="Publish_Click" />
                    </WrapPanel>
                </StackPanel>
            </Grid>
        </ui:Card>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <ui:Card Grid.Column="0" Padding="12" Margin="0,0,12,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <ui:TextBlock Style="{StaticResource SectionHeaderStyle}" Text="Tree Profile" />

                    <StackPanel Grid.Row="1">
                        <WrapPanel Margin="0,0,0,8">
                            <ui:TextBlock Text="Profile:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <ComboBox Width="220"
                                      ItemsSource="{Binding Profiles}"
                                      SelectedItem="{Binding SelectedProfile}"
                                      DisplayMemberPath="Name"
                                      Margin="0,0,8,0" />
                            <ui:Button Content="Save" Margin="0,0,8,0" Click="SaveProfile_Click" />
                            <ui:Button Content="Save As" Margin="0,0,8,0" Click="SaveProfileAs_Click" />
                            <ui:Button Content="Reload" Click="ReloadProfile_Click" />
                        </WrapPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ui:TextBlock Text="Profile Name" VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBox Grid.Column="1"
                                     MinWidth="220"
                                     Text="{Binding ProfileName, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <ui:Button Click="AddLevel_Click" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="Add20" Margin="0,0,6,0" />
                                    <ui:TextBlock Text="Add Level" />
                                </StackPanel>
                            </ui:Button>
                            <ui:Button Click="RemoveLevel_Click" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="Dismiss16" Margin="0,0,6,0" />
                                    <ui:TextBlock Text="Remove" />
                                </StackPanel>
                            </ui:Button>
                            <ui:Button Click="MoveLevelUp_Click" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="ArrowUp16" Margin="0,0,6,0" />
                                    <ui:TextBlock Text="Move Up" />
                                </StackPanel>
                            </ui:Button>
                            <ui:Button Click="MoveLevelDown_Click">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="ArrowDown16" Margin="0,0,6,0" />
                                    <ui:TextBlock Text="Move Down" />
                                </StackPanel>
                            </ui:Button>
                        </StackPanel>
                    </StackPanel>

                    <ui:DataGrid x:Name="LevelsGrid"
                                 Grid.Row="2"
                                 Margin="0,10,0,0"
                                 ItemsSource="{Binding Levels}"
                                 SelectedItem="{Binding SelectedLevel, Mode=TwoWay}"
                                 AutoGenerateColumns="False"
                                 CanUserAddRows="False"
                                 CanUserDeleteRows="False"
                                 CanUserReorderColumns="False"
                                 CanUserSortColumns="False"
                                 SelectionMode="Single"
                                 SelectionUnit="FullRow"
                                 RowHeight="28"
                                 ColumnHeaderHeight="30"
                                 FontSize="12"
                                 GridLinesVisibility="All"
                                 HorizontalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                 VerticalGridLinesBrush="{DynamicResource MicroEngDataGridGridLineBrush}"
                                 ColumnHeaderStyle="{StaticResource TreeMapperColumnHeaderStyle}">
                        <ui:DataGrid.Columns>
                            <DataGridTemplateColumn Header="Node Type" Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding NodeType}" VerticalAlignment="Center" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding NodeTypeOptions}"
                                                  SelectedItem="{Binding NodeType, UpdateSourceTrigger=PropertyChanged}"
                                                  Height="26" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Category" Width="180">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Category}" VerticalAlignment="Center" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding CategoryOptions}"
                                                  SelectedItem="{Binding Category, UpdateSourceTrigger=PropertyChanged}"
                                                  IsEditable="True"
                                                  IsTextSearchEnabled="True"
                                                  Height="26" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Property" Width="220">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding PropertyName}" VerticalAlignment="Center" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding PropertyOptions}"
                                                  SelectedItem="{Binding PropertyName, UpdateSourceTrigger=PropertyChanged}"
                                                  IsEditable="True"
                                                  IsTextSearchEnabled="True"
                                                  Height="26" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Missing Label"
                                                Binding="{Binding MissingLabel, UpdateSourceTrigger=PropertyChanged}"
                                                Width="*"
                                                MinWidth="180" />

                            <DataGridTemplateColumn Header="Sort" Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding SortMode}" VerticalAlignment="Center" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding SortModeOptions}"
                                                  SelectedItem="{Binding SortMode, UpdateSourceTrigger=PropertyChanged}"
                                                  Height="26" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                        </ui:DataGrid.Columns>
                    </ui:DataGrid>
                </Grid>
            </ui:Card>

            <ui:Card Grid.Column="1" Padding="12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <ui:TextBlock Style="{StaticResource SectionHeaderStyle}" Text="Preview" />
                    <TreeView Grid.Row="1"
                              ItemsSource="{Binding PreviewRoots}"
                              BorderThickness="0"
                              Background="Transparent"
                              ScrollViewer.CanContentScroll="True"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              VirtualizingStackPanel.VirtualizationMode="Recycling">
                        <TreeView.Resources>
                            <HierarchicalDataTemplate DataType="{x:Type treemapper:TreeMapperPreviewNode}"
                                                      ItemsSource="{Binding Children}">
                                <ui:TextBlock Text="{Binding DisplayLabel}" TextWrapping="Wrap" />
                            </HierarchicalDataTemplate>
                        </TreeView.Resources>
                    </TreeView>
                </Grid>
            </ui:Card>
        </Grid>
    </Grid>
</Window>
